- name: Create Kafka dirs
  file:
    path: "/opt/kafka-{{ env }}/{{ item }}"
    owner: root
    group: root
    mode: 0755
    state: directory
  loop:
    - data
    - config
    - logs

- name: Copy Kafka JAAS config
  template:
    src: "templates/kafka_jaas.conf.j2"
    dest: "/opt/kafka-{{ env }}/config/kafka_jaas.conf"

- name: Copy Kafka config
  template:
    src: "templates/server_local.properties.j2"
    dest: "/opt/kafka-{{ env }}/config/server.properties"

- name: Copy Kafka service file
  template:
    src: "templates/kafka_local.service.j2"
    dest: "/etc/systemd/system/kafka-{{ env }}.service"

- name: Pull Kafka image
  docker_image:
    name: iaroki/kafka
    tag: "{{ ver }}"
    source: pull
    state: present

- name: Start Kafka service
  systemd:
    name: "kafka-{{ env }}.service"
    state: started
    enabled: yes
    daemon_reload: yes
